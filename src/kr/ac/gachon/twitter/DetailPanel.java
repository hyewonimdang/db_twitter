package kr.ac.gachon.twitter;

import javax.swing.*;
import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.List;
import java.sql.Timestamp;

public class DetailPanel extends JPanel {
    private Post post;
    private List<Comment> comments;
    private User currentUser;
    private JPanel messagesPanel;

    public DetailPanel(Post post, List<Comment> comments) {
        this.post = post;
        this.comments = comments;
        this.currentUser = SessionManager.getInstance().getCurrentUser();
        initialize();
    }

    private void initialize() {
        setLayout(new BorderLayout());

        // Ï†ÑÏ≤¥ ÎÇ¥Ïö©ÏùÑ Îã¥ÏùÑ Ìå®ÎÑê
        JPanel mainContentPanel = new JPanel();
        mainContentPanel.setLayout(new BoxLayout(mainContentPanel, BoxLayout.Y_AXIS));
        mainContentPanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));

        // Ïä§ÌÅ¨Î°§Î∞î ÎÑàÎπÑ Í≥ÑÏÇ∞
        JScrollBar verticalBar = new JScrollBar(JScrollBar.VERTICAL);
        int scrollBarWidth = verticalBar.getPreferredSize().width;

        // Ïã§Ï†ú Ïª®ÌÖêÏ∏† ÏòÅÏó≠Ïùò ÎÑàÎπÑ Í≥ÑÏÇ∞ (400 - Ïä§ÌÅ¨Î°§Î∞î ÎÑàÎπÑ - Ïó¨Î∞±)
        int contentWidth = 400 - scrollBarWidth - 20; // 20ÏùÄ Ï¢åÏö∞ Ïó¨Î∞±(10px * 2)
        mainContentPanel.setMaximumSize(new Dimension(contentWidth, Integer.MAX_VALUE));

        // Header Panel (ÏÉÅÎã®)
        JPanel headerPanel = createHeaderPanel();
        mainContentPanel.add(headerPanel);

        // ÎåìÍ∏Ä ÏûÖÎ†• ÏÑπÏÖò
        JPanel commentInputPanel = new JPanel(new BorderLayout(0, 0));
        commentInputPanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));
        commentInputPanel.setAlignmentX(Component.LEFT_ALIGNMENT);

        JTextField commentField = new JTextField();
        JButton submitButton = subMitComment("images/Send.png", 30, 30);

        submitButton.addActionListener(e -> {
            String content = commentField.getText();
            if (!content.isEmpty()) {
                DatabaseServer db = new DatabaseServer();
                Comment newComment = new Comment(
                        0,
                        post.getPostId(),
                        0,
                        currentUser.getUid(),
                        content,
                        0,
                        new Timestamp(System.currentTimeMillis()));

                if (db.addComment(newComment)) {
                    commentField.setText("");
                    refreshComments();
                } else {
                    JOptionPane.showMessageDialog(this,
                            "Failed to add comment",
                            "Error",
                            JOptionPane.ERROR_MESSAGE);
                }
            }
        });

        // Î≤ÑÌäºÍ≥º ÌÖçÏä§Ìä∏ ÌïÑÎìú Î∞∞Ïπò
        commentInputPanel.add(commentField, BorderLayout.CENTER);
        commentInputPanel.add(submitButton, BorderLayout.EAST);

        mainContentPanel.add(commentInputPanel);

        /*
         * 
         * // Î≤ÑÌäº ÎÑàÎπÑÎ•º 80ÏúºÎ°ú ÌïòÍ≥†, ÏûÖÎ†• ÌïÑÎìúÎäî Ïä§ÌÅ¨Î°§Î∞î ÎÑàÎπÑÍπåÏßÄ Í≥†Î†§Ìï¥ÏÑú Ï°∞Ï†ï
         * submitButton.setPreferredSize(new Dimension(80, 30));
         * commentField.setPreferredSize(new Dimension(contentWidth - 80, 30));
         * 
         * submitButton.addActionListener(e -> {
         * String content = commentField.getText();
         * if (!content.isEmpty()) {
         * DatabaseServer db = new DatabaseServer();
         * Comment newComment = new Comment(
         * 0,
         * post.getPostId(),
         * 0,
         * currentUser.getUid(),
         * content,
         * 0,
         * new Timestamp(System.currentTimeMillis()));
         * 
         * if (db.addComment(newComment)) {
         * commentField.setText("");
         * refreshComments();
         * } else {
         * JOptionPane.showMessageDialog(this,
         * "Failed to add comment",
         * "Error",
         * JOptionPane.ERROR_MESSAGE);
         * }
         * }
         * });
         * 
         * commentInputPanel.add(commentField, BorderLayout.CENTER);
         * commentInputPanel.add(submitButton, BorderLayout.EAST);
         * 
         * mainContentPanel.add(commentInputPanel);
         */

        // ÎåìÍ∏Ä Î™©Î°ù Ìå®ÎÑê
        messagesPanel = new JPanel();
        messagesPanel.setLayout(new BoxLayout(messagesPanel, BoxLayout.Y_AXIS));
        messagesPanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));
        mainContentPanel.add(messagesPanel);

        // Ï†ÑÏ≤¥ Ïä§ÌÅ¨Î°§ Ìå®ÎÑê
        JScrollPane scrollPane = new JScrollPane(mainContentPanel);
        scrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);
        scrollPane.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
        scrollPane.getVerticalScrollBar().setUnitIncrement(16);
        scrollPane.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
        add(scrollPane, BorderLayout.CENTER);

        // ÌïòÎã® Î≤ÑÌäº Ìå®ÎÑê
        JPanel bottomPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 0, 5));
        bottomPanel.setBorder(BorderFactory.createEmptyBorder(0, 10, 0, 10));
        JButton backButton = BackPage("images/Arrow left.png");

        bottomPanel.add(backButton);
        add(bottomPanel, BorderLayout.SOUTH);

        refreshComments();
    }

    private void displayComments() {
        // messagesPanel Ï¥àÍ∏∞Ìôî
        messagesPanel.removeAll();

        DatabaseServer db = new DatabaseServer();
        for (Comment comment : comments) {
            JPanel commentPanel = new JPanel();
            commentPanel.setLayout(new BoxLayout(commentPanel, BoxLayout.Y_AXIS));
            commentPanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));
            commentPanel.setAlignmentX(Component.LEFT_ALIGNMENT);

            // ÎåìÍ∏Ä ÏûëÏÑ±Ïûê
            String commentUsername = db.getUsernameById(comment.getCreatedBy());
            JLabel commentUserLabel = new JLabel("<html><u>" + commentUsername + "</u></html>");
            commentUserLabel.setFont(new Font("Arial", Font.BOLD, 12));
            commentUserLabel.setCursor(new Cursor(Cursor.HAND_CURSOR));
            commentUserLabel.setForeground(new Color(29, 161, 242));
            commentUserLabel.setAlignmentX(Component.LEFT_ALIGNMENT);

            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            commentUserLabel.addMouseListener(new MouseAdapter() {
                public void mouseClicked(MouseEvent evt) {
                    User commentUser = db.getUserById(String.valueOf(comment.getCreatedBy()));
                    if (commentUser != null) {
                        Container parent = getParent();
                        while (parent != null && !(parent instanceof TwitterUI)) {
                            parent = parent.getParent();
                        }
                        if (parent instanceof TwitterUI) {
                            ProfilePanel profilePanel = new ProfilePanel(commentUser);
                            JPanel mainPanel = (JPanel) getParent();
                            mainPanel.add(profilePanel, "Profile");
                            CardLayout cardLayout = (CardLayout) mainPanel.getLayout();
                            cardLayout.show(mainPanel, "Profile");
                        }
                    }
                }

                public void mouseEntered(MouseEvent evt) {
                    commentUserLabel.setForeground(new Color(20, 120, 180));
                }

                public void mouseExited(MouseEvent evt) {
                    commentUserLabel.setForeground(new Color(29, 161, 242));
                }
            });

            // ÎåìÍ∏Ä ÎÇ¥Ïö©
            JLabel commentContentLabel = new JLabel();
            commentContentLabel.setText(comment.getContent());
            commentContentLabel.setFont(new Font("Arial", Font.PLAIN, 12));
            commentContentLabel.setAlignmentX(Component.LEFT_ALIGNMENT);

            // Ï¢ãÏïÑÏöî Î≤ÑÌäºÍ≥º Ïπ¥Ïö¥Ìä∏Î•º Ìè¨Ìï®Ìïú Ìå®ÎÑê
            JPanel likePanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 0, 0));
            likePanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));
            likePanel.setAlignmentX(Component.LEFT_ALIGNMENT);
            JButton likeButton = new JButton(
                    (db.hasLikedComment(comment.getCommentId(), currentUser.getUid()) ? "üíî " : "‚ù§Ô∏è ")
                            + comment.getLikedCnt());
            likeButton.setPreferredSize(new Dimension(80, 30)); // Î≤ÑÌäº ÌÅ¨Í∏∞ ÏÑ§Ï†ï

            likeButton.addActionListener(e -> {
                boolean isLiked = db.hasLikedComment(comment.getCommentId(), currentUser.getUid());
                boolean success;

                if (isLiked) {
                    success = db.unlikeComment(comment.getCommentId(), currentUser.getUid());
                    if (success) {
                        likeButton.setText("‚ù§Ô∏è " + (comment.getLikedCnt() - 1));
                    }
                } else {
                    success = db.likeComment(comment.getCommentId(), currentUser.getUid());
                    if (success) {
                        likeButton.setText("üíî " + (comment.getLikedCnt() + 1));
                    }
                }
                if (success) {
                    refreshComments();
                }
            });

            // ÎåìÍ∏Ä ÏûëÏÑ±ÏûêÏù∏ Í≤ΩÏö∞ ÏÇ≠Ï†ú Î≤ÑÌäº Ï∂îÍ∞Ä
            if (db.isCommentOwner(comment.getCommentId(), currentUser.getUid())) {
                JButton deleteButton = new JButton("üóëÔ∏è");
                deleteButton.setPreferredSize(new Dimension(80, 30)); // Î≤ÑÌäº ÌÅ¨Í∏∞ ÏÑ§Ï†ï
                deleteButton.addActionListener(e -> {
                    int confirm = JOptionPane.showConfirmDialog(
                            this,
                            "Are you sure you want to delete this comment?",
                            "Confirm Delete",
                            JOptionPane.YES_NO_OPTION);

                    if (confirm == JOptionPane.YES_OPTION) {
                        if (db.deleteComment(comment.getCommentId())) {
                            refreshComments();
                        }
                    }
                });
                likePanel.add(deleteButton);
            }

            likePanel.add(likeButton);
            commentPanel.add(commentUserLabel);
            commentPanel.add(commentContentLabel);
            commentPanel.add(likePanel);
            commentPanel.add(new JSeparator(SwingConstants.HORIZONTAL));

            messagesPanel.add(commentPanel);
            messagesPanel.add(Box.createRigidArea(new Dimension(0, 5)));
        }

        messagesPanel.revalidate();
        messagesPanel.repaint();
    }

    private void refreshComments() {
        DatabaseServer db = new DatabaseServer();
        comments = db.getCommentsByPostId(post.getPostId());
        displayComments();
    }

    private void refreshPost() {
        DatabaseServer db = new DatabaseServer();
        Post updatedPost = db.getPostById(post.getPostId());
        if (updatedPost != null) {
            this.post = updatedPost;
            removeAll();
            initialize();
            revalidate();
            repaint();
        }
    }

    private JPanel createHeaderPanel() {
        JPanel headerPanel = new JPanel();
        headerPanel.setLayout(new BoxLayout(headerPanel, BoxLayout.Y_AXIS));
        headerPanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));
        headerPanel.setAlignmentX(Component.LEFT_ALIGNMENT);

        // Ïú†Ï†Ä Ïù¥Î¶ÑÏùÑ ÌÅ¥Î¶≠ Í∞ÄÎä•Ìïú ÎßÅÌÅ¨Ï≤òÎüº ÎßåÎì§Í∏∞
        DatabaseServer db = new DatabaseServer();
        String username = db.getUsernameById(post.getCreatedBy());
        JLabel usernameLabel = new JLabel("<html><u>" + username + "</u></html>");
        usernameLabel.setFont(new Font("Arial", Font.BOLD, 16));
        usernameLabel.setCursor(new Cursor(Cursor.HAND_CURSOR));
        usernameLabel.setForeground(new Color(29, 161, 242));
        usernameLabel.setAlignmentX(Component.LEFT_ALIGNMENT); // ÏôºÏ™Ω Ï†ïÎ†¨

        // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
        usernameLabel.addMouseListener(new MouseAdapter() {
            public void mouseClicked(MouseEvent evt) {
                User postUser = db.getUserById(String.valueOf(post.getCreatedBy()));
                if (postUser != null) {
                    Container parent = getParent();
                    while (parent != null && !(parent instanceof TwitterUI)) {
                        parent = parent.getParent();
                    }
                    if (parent instanceof TwitterUI) {
                        ProfilePanel profilePanel = new ProfilePanel(postUser);
                        JPanel mainPanel = (JPanel) getParent();
                        mainPanel.add(profilePanel, "Profile");
                        CardLayout cardLayout = (CardLayout) mainPanel.getLayout();
                        cardLayout.show(mainPanel, "Profile");
                    }
                }
            }

            public void mouseEntered(MouseEvent evt) {
                usernameLabel.setForeground(new Color(20, 120, 180));
            }

            public void mouseExited(MouseEvent evt) {
                usernameLabel.setForeground(new Color(29, 161, 242));
            }
        });

        // Í∏Ä ÎÇ¥Ïö©ÏùÑ Ìï¥ÏãúÌÉúÍ∑∏Í∞Ä ÌÅ¥Î¶≠ Í∞ÄÎä•ÌïòÎèÑÎ°ù Î≥ÄÌôò
        JPanel contentPanel = new JPanel();
        contentPanel.setLayout(new FlowLayout(FlowLayout.LEFT, 0, 0));
        contentPanel.setAlignmentX(Component.LEFT_ALIGNMENT);

        String[] words = post.getContent().split("\\s+");
        for (String word : words) {
            if (word.startsWith("#")) {
                // Ìï¥ÏãúÌÉúÍ∑∏Ïù∏ Í≤ΩÏö∞ ÌÅ¥Î¶≠ Í∞ÄÎä•Ìïú ÎùºÎ≤®Î°ú ÏÉùÏÑ±
                JLabel hashtagLabel = new JLabel(word);
                hashtagLabel.setForeground(new Color(29, 161, 242));
                hashtagLabel.setCursor(new Cursor(Cursor.HAND_CURSOR));
                hashtagLabel.addMouseListener(new MouseAdapter() {
                    @Override
                    public void mouseClicked(MouseEvent e) {
                        // SearchPanelÎ°ú Ïù¥ÎèôÌïòÍ≥† Ìï¥ÏãúÌÉúÍ∑∏ Í≤ÄÏÉâ ÏàòÌñâ
                        Container parent = getParent();
                        while (parent != null && !(parent instanceof JPanel)) {
                            parent = parent.getParent();
                        }
                        if (parent != null) {
                            SearchPanel searchPanel = new SearchPanel();
                            parent.add(searchPanel, "Search");
                            CardLayout layout = (CardLayout) parent.getLayout();
                            layout.show(parent, "Search");
                            // Ìï¥ÏãúÌÉúÍ∑∏ Í≤ÄÏÉâ ÏàòÌñâ
                            searchPanel.performSearch(word);
                        }
                    }

                    @Override
                    public void mouseEntered(MouseEvent e) {
                        hashtagLabel.setForeground(new Color(20, 120, 180));
                    }

                    @Override
                    public void mouseExited(MouseEvent e) {
                        hashtagLabel.setForeground(new Color(29, 161, 242));
                    }
                });
                contentPanel.add(hashtagLabel);
            } else {
                // ÏùºÎ∞ò ÌÖçÏä§Ìä∏Ïù∏ Í≤ΩÏö∞
                contentPanel.add(new JLabel(word));
            }
            contentPanel.add(new JLabel(" ")); // Îã®Ïñ¥ ÏÇ¨Ïù¥Ïóê Í≥µÎ∞± Ï∂îÍ∞Ä
        }

        // contentLabel ÎåÄÏã† contentPanelÏùÑ Ï∂îÍ∞Ä
        headerPanel.add(contentPanel);

        // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ ÌëúÏãú
        JLabel imageLabel = null;
        if (post.getImagePath() != null && !post.getImagePath().isEmpty()) {
            try {
                ImageIcon originalIcon = new ImageIcon(post.getImagePath());
                Image originalImage = originalIcon.getImage();

                // Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ Ï°∞Ï†ï (ÏµúÎåÄ 400x400)
                int maxWidth = 400;
                int maxHeight = 400;
                int originalWidth = originalImage.getWidth(null);
                int originalHeight = originalImage.getHeight(null);

                double scale = Math.min((double) maxWidth / originalWidth, (double) maxHeight / originalHeight);
                int scaledWidth = (int) (originalWidth * scale);
                int scaledHeight = (int) (originalHeight * scale);

                Image scaledImage = originalImage.getScaledInstance(scaledWidth, scaledHeight, Image.SCALE_SMOOTH);
                ImageIcon scaledIcon = new ImageIcon(scaledImage);

                imageLabel = new JLabel(scaledIcon);
                imageLabel.setAlignmentX(Component.LEFT_ALIGNMENT);

                // Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠ Ïãú Ïõê ÌÅ¨Í∏∞Î°ú Î≥¥Í∏∞
                imageLabel.setCursor(new Cursor(Cursor.HAND_CURSOR));
                imageLabel.addMouseListener(new MouseAdapter() {
                    @Override
                    public void mouseClicked(MouseEvent e) {
                        JDialog dialog = new JDialog();
                        dialog.setTitle("Image Viewer");

                        // ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
                        JLabel fullImageLabel = new JLabel(new ImageIcon(post.getImagePath()));
                        JScrollPane scrollPane = new JScrollPane(fullImageLabel);
                        dialog.add(scrollPane);

                        // Îã´Í∏∞ Î≤ÑÌäº
                        JButton closeButton = new JButton("Close");
                        closeButton.addActionListener(event -> dialog.dispose());
                        dialog.add(closeButton, BorderLayout.SOUTH);

                        dialog.setSize(800, 800);
                        dialog.setLocationRelativeTo(null);
                        dialog.setVisible(true);
                    }
                });
            } catch (Exception e) {
                e.printStackTrace();
                imageLabel = new JLabel("Failed to load image");
                imageLabel.setAlignmentX(Component.LEFT_ALIGNMENT);
            }
        }

        // Ïï°ÏÖò Î≤ÑÌäº Ìå®ÎÑê (Ï¢ãÏïÑÏöî, Ïä§ÌÅ¨Îû©)
        JPanel actionPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 0, 0));
        actionPanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));
        actionPanel.setAlignmentX(Component.LEFT_ALIGNMENT);

        DatabaseServer dbServer = new DatabaseServer();

        // Ï¢ãÏïÑÏöî Î≤ÑÌäºÍ≥º Ïπ¥Ïö¥Ìä∏
        JButton likeButton = new JButton(
                (dbServer.hasLikedPost(post.getPostId(), currentUser.getUid()) ? "üíî " : "‚ù§Ô∏è ") + post.getLikedCnt());
        likeButton.setPreferredSize(new Dimension(80, 30)); // Î≤ÑÌäº ÌÅ¨Í∏∞ ÏÑ§Ï†ï

        likeButton.addActionListener(e -> {
            boolean isLiked = dbServer.hasLikedPost(post.getPostId(), currentUser.getUid());
            boolean success;
            if (isLiked) {
                success = dbServer.unlikePost(post.getPostId(), currentUser.getUid());
                if (success)
                    likeButton.setText("‚ù§Ô∏è " + (post.getLikedCnt() - 1));
            } else {
                success = dbServer.likePost(post.getPostId(), currentUser.getUid());
                if (success)
                    likeButton.setText("üíî " + (post.getLikedCnt() + 1));
            }
            if (success)
                refreshPost();
        });

        // Ïä§ÌÅ¨Îû© Î≤ÑÌäº
        JButton saveButton = new JButton(dbServer.hasScraped(post.getPostId(), currentUser.getUid()) ? "üìå" : "üìç");
        saveButton.setPreferredSize(new Dimension(60, 30)); // Î≤ÑÌäº ÌÅ¨Í∏∞ ÏÑ§Ï†ï
        saveButton.addActionListener(e -> {
            boolean isScraped = dbServer.hasScraped(post.getPostId(), currentUser.getUid());
            boolean success;
            if (isScraped) {
                success = dbServer.removeScrap(post.getPostId(), currentUser.getUid());
                if (success) {
                    saveButton.setText("üìç");
                    JOptionPane.showMessageDialog(this, "Post removed from scraps");
                }
            } else {
                success = dbServer.addScrap(post.getPostId(), currentUser.getUid());
                if (success) {
                    saveButton.setText("üìå");
                    JOptionPane.showMessageDialog(this, "Post added to scraps");
                }
            }
        });

        // Í≤åÏãúÎ¨º ÏûëÏÑ±ÏûêÏù∏ Í≤ΩÏö∞ ÏÇ≠Ï†ú Î≤ÑÌäº Ï∂îÍ∞Ä
        if (dbServer.isPostOwner(post.getPostId(), currentUser.getUid())) {
            JButton deleteButton = new JButton("üóëÔ∏è");
            deleteButton.setPreferredSize(new Dimension(60, 30)); // Ìäº ÌÅ¨Í∏∞ ÏÑ§Ï†ï
            deleteButton.addActionListener(e -> {
                int confirm = JOptionPane.showConfirmDialog(
                        this,
                        "Are you sure you want to delete this post?",
                        "Confirm Delete",
                        JOptionPane.YES_NO_OPTION);
                if (confirm == JOptionPane.YES_OPTION) {
                    if (dbServer.deletePost(post.getPostId())) {
                        JOptionPane.showMessageDialog(this, "Post deleted successfully!");
                        Container parent = getParent();
                        while (parent != null && !(parent instanceof TwitterUI)) {
                            parent = parent.getParent();
                        }
                        if (parent instanceof TwitterUI) {
                            ((TwitterUI) parent).refreshFeed();
                        }
                        CardLayout cardLayout = (CardLayout) getParent().getLayout();
                        cardLayout.show(getParent(), "Feed");
                    }
                }
            });
            actionPanel.add(deleteButton);
        }

        actionPanel.add(likeButton);
        actionPanel.add(saveButton);

        headerPanel.add(usernameLabel);
        headerPanel.add(Box.createRigidArea(new Dimension(0, 10)));
        headerPanel.add(contentPanel);

        // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ Ï∂îÍ∞Ä
        if (imageLabel != null) {
            headerPanel.add(Box.createRigidArea(new Dimension(0, 10)));
            headerPanel.add(imageLabel);
        }

        headerPanel.add(Box.createRigidArea(new Dimension(0, 10)));
        headerPanel.add(actionPanel);

        return headerPanel;
    }

    private JButton BackPage(String filePath) {
        try {
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú Î∞è ÌÅ¨Í∏∞ Ï°∞Ï†ï
            ImageIcon icon = new ImageIcon(
                    new ImageIcon(filePath).getImage().getScaledInstance(20, 20, Image.SCALE_SMOOTH));

            // Î≤ÑÌäº ÏÉùÏÑ±
            JButton imageButton = new JButton(icon);

            // Î≤ÑÌäº Ïä§ÌÉÄÏùº Ï†úÍ±∞ (Ïù¥ÎØ∏ÏßÄÏ≤òÎüº Î≥¥Ïù¥Í≤å ÏÑ§Ï†ï)
            imageButton.setBorderPainted(false); // Ïô∏Í≥ΩÏÑ† Ï†úÍ±∞
            imageButton.setContentAreaFilled(false);
            imageButton.setFocusPainted(false); // Ìè¨Ïª§Ïä§ ÌëúÏãú Ï†úÍ±∞

            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            imageButton.addActionListener(e -> {
                Container parent = getParent();
                while (parent != null && !(parent instanceof TwitterUI)) {
                    parent = parent.getParent();
                }
                if (parent instanceof TwitterUI) {
                    ((TwitterUI) parent).refreshFeed();
                }
                CardLayout cardLayout = (CardLayout) getParent().getLayout();
                cardLayout.show(getParent(), "Feed");
            });

            return imageButton;
        } catch (Exception e) {
            // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ ÎåÄÏ≤¥ ÌÖçÏä§Ìä∏ Î≤ÑÌäº ÏÉùÏÑ±
            JButton placeholderButton = new JButton("Image not found");
            placeholderButton.setEnabled(false); // ÌÅ¥Î¶≠ Î∂àÍ∞ÄÎä•
            return placeholderButton;
        }
    }

    private JButton subMitComment(String filePath, int width, int height) {
        try {
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú Î∞è ÌÅ¨Í∏∞ Ï°∞Ï†ï
            ImageIcon icon = new ImageIcon(
                    new ImageIcon(filePath).getImage().getScaledInstance(width, height, Image.SCALE_SMOOTH));

            // Î≤ÑÌäº ÏÉùÏÑ±
            JButton imageButton = new JButton(icon);

            // Î≤ÑÌäº Ïä§ÌÉÄÏùº Ï†úÍ±∞ (Ïù¥ÎØ∏ÏßÄÏ≤òÎüº Î≥¥Ïù¥Í≤å ÏÑ§Ï†ï)
            imageButton.setBorderPainted(false); // Ïô∏Í≥ΩÏÑ† Ï†úÍ±∞
            imageButton.setContentAreaFilled(false); // Î∞∞Í≤Ω Ï†úÍ±∞
            imageButton.setFocusPainted(false); // Ìè¨Ïª§Ïä§ ÌëúÏãú Ï†úÍ±∞

            return imageButton;
        } catch (Exception e) {
            // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ ÎåÄÏ≤¥ Î≤ÑÌäº ÏÉùÏÑ±
            JButton placeholderButton = new JButton("Send");
            placeholderButton.setEnabled(false); // ÌÅ¥Î¶≠ Î∂àÍ∞ÄÎä•
            return placeholderButton;
        }
    }

}
